{"paragraphs":[{"text":"%spark2\r\nimport org.apache.spark._\r\nimport org.apache.spark.rdd._\r\nimport org.apache.spark.SparkContext._\r\nimport org.apache.spark.mllib.feature.HashingTF\r\nimport org.apache.spark.{SparkConf, SparkContext}\r\nimport org.apache.spark.mllib.regression.LabeledPoint\r\nimport org.apache.spark.mllib.tree.GradientBoostedTrees\r\nimport org.apache.spark.mllib.tree.configuration.BoostingStrategy\r\nimport org.apache.spark._\r\nimport org.apache.spark.rdd._\r\nimport org.apache.spark.SparkContext._\r\nimport scala.util.{Success, Try}\r\n\r\n    val sqlContext = new org.apache.spark.sql.SQLContext(sc)\r\n\r\n    var tweetDF = sqlContext.read.json(\"hdfs:///sandbox/tutorial-files/770/tweets_staging/*\")\r\n    tweetDF.show()","user":"anonymous","dateUpdated":"2018-09-24T05:14:19+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark._\nimport org.apache.spark.rdd._\nimport org.apache.spark.SparkContext._\nimport org.apache.spark.mllib.feature.HashingTF\nimport org.apache.spark.{SparkConf, SparkContext}\nimport org.apache.spark.mllib.regression.LabeledPoint\nimport org.apache.spark.mllib.tree.GradientBoostedTrees\nimport org.apache.spark.mllib.tree.configuration.BoostingStrategy\nimport org.apache.spark._\nimport org.apache.spark.rdd._\nimport org.apache.spark.SparkContext._\nimport scala.util.{Success, Try}\nwarning: there was one deprecation warning; re-run with -deprecation for details\nsqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@5b5ac875\ntweetDF: org.apache.spark.sql.DataFrame = [_corrupt_record: string, created_time: string ... 6 more fields]\n+---------------+--------------------+----------------+---------------+----+--------------------+--------------------+------------------+\n|_corrupt_record|        created_time|created_unixtime|    displayname|lang|                 msg|           time_zone|          tweet_id|\n+---------------+--------------------+----------------+---------------+----+--------------------+--------------------+------------------+\n|           null|Wed Mar 15 00:37:...|   1489538246855| amanda_obrien_|  en|when i was little...|                    |841810537394667520|\n|           null|Wed Mar 15 00:37:...|   1489538246983|   tinxdelacruz|  en|RT NashLenersOFC ...|             Beijing|841810537931456512|\n|           null|Wed Mar 15 00:37:...|   1489538247091|  esteladic2126|  es|RT Sugarlapin8 Te...|                    |841810538384384000|\n|           null|Wed Mar 15 00:37:...|   1489538247086|      _cabrisun|  en|poppinmahle happy...|Atlantic Time (Ca...|841810538363535360|\n|           null|Wed Mar 15 00:37:...|   1489538247093|    shabadoobie|  en|RT robinthede Rea...|Eastern Time (US ...|841810538392891392|\n|           null|Wed Mar 15 00:37:...|   1489538247076|   wompastompa1|  en|RT bwecht Happy B...|                    |841810538321612800|\n|           null|Wed Mar 15 00:37:...|   1489538247109|      NjDiestro|  tl|Happy birthday br...|                    |841810538459885568|\n|           null|Wed Mar 15 00:37:...|   1489538247233|     itschloooe|  en|How happy would u...|              London|841810538980089857|\n|           null|Wed Mar 15 00:37:...|   1489538247391|   paulinejoy97|  en|RT ohmybaequotes ...|                    |841810539642724353|\n|           null|Wed Mar 15 00:37:...|   1489538247248|5e1628bb947d498|  en|RT andibeth012 Si...|                    |841810539043004416|\n|           null|Wed Mar 15 00:37:...|   1489538247404|         dbsudg|  ja|【連載マンガ】「ほしとくずDont...|                    |841810539697201152|\n|           null|Wed Mar 15 00:37:...|   1489538247335|DrClarkIPresume|  en|RT KenJennings Th...|              Hawaii|841810539407908864|\n|           null|Wed Mar 15 00:37:...|   1489538247399|    kurokita666|  ja|RT 1717frappuccin...|                    |841810539676291072|\n|           null|Wed Mar 15 00:37:...|   1489538247522|     sherrygrey|  en|SusanSarandon So ...|                    |841810540192178176|\n|           null|Wed Mar 15 00:37:...|   1489538247456|       CTudor88|  en|Pet peeve its ven...|Eastern Time (US ...|841810539915415552|\n|           null|Wed Mar 15 00:37:...|   1489538247123| TheOfficialRK_|  en|Yo happy birthday...|Eastern Time (US ...|841810538518700034|\n|           null|Wed Mar 15 00:37:...|   1489538247618|     EricFundak|  en|RT richthekid Foc...|Pacific Time (US ...|841810540594925568|\n|           null|Wed Mar 15 00:37:...|   1489538247505|          bin99|  en|RT davidfrawleyve...|              Mumbai|841810540120969216|\n|           null|Wed Mar 15 00:37:...|   1489538247621|        yxzmin_|  es|RT carlosbugani s...|Pacific Time (US ...|841810540607467520|\n|           null|Wed Mar 15 00:37:...|   1489538247831|        Viffido|  en|RT bwecht Happy B...|             Caracas|841810541488267266|\n+---------------+--------------------+----------------+---------------+----+--------------------+--------------------+------------------+\nonly showing top 20 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=0","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=1","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=2","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=3"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1537762734886_-1352946514","id":"20180924-041854_70555897","dateCreated":"2018-09-24T04:18:54+0000","dateStarted":"2018-09-24T05:14:19+0000","dateFinished":"2018-09-24T05:21:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1775"},{"text":"%spark2\r\nvar messages = tweetDF.select(\"msg\")\r\nprintln(\"Total messages: \" + messages.count())\r\n\r\nvar happyMessages = messages.filter(messages(\"msg\").contains(\"happy\"))\r\nval countHappy = happyMessages.count()\r\nprintln(\"Number of happy messages: \" +  countHappy)\r\n\r\nvar unhappyMessages = messages.filter(messages(\"msg\").contains(\" sad\"))\r\nval countUnhappy = unhappyMessages.count()\r\nprintln(\"Unhappy Messages: \" + countUnhappy)\r\n\r\nval smallest = Math.min(countHappy, countUnhappy).toInt\r\n\r\n//Create a dataset with equal parts happy and unhappy messages\r\nvar tweets = happyMessages.limit(smallest).unionAll(unhappyMessages.limit(smallest))","user":"anonymous","dateUpdated":"2018-09-24T05:22:01+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"messages: org.apache.spark.sql.DataFrame = [msg: string]\nTotal messages: 14440\nhappyMessages: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msg: string]\ncountHappy: Long = 5351\nNumber of happy messages: 5351\nunhappyMessages: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msg: string]\ncountUnhappy: Long = 1932\nUnhappy Messages: 1932\nsmallest: Int = 1932\nwarning: there was one deprecation warning; re-run with -deprecation for details\ntweets: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [msg: string]\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=4","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=5","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=6"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1537762751675_-505152442","id":"20180924-041911_1437106957","dateCreated":"2018-09-24T04:19:11+0000","dateStarted":"2018-09-24T05:22:01+0000","dateFinished":"2018-09-24T05:22:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1776"},{"text":"%spark2\r\nval messagesRDD = tweets.rdd\r\n//We use scala's Try to filter out tweets that couldn't be parsed\r\nval goodBadRecords = messagesRDD.map(\r\n  row =>{\r\n    Try{\r\n      val msg = row(0).toString.toLowerCase()\r\n      var isHappy:Int = 0\r\n      if(msg.contains(\" sad\")){\r\n        isHappy = 0\r\n      }else if(msg.contains(\"happy\")){\r\n        isHappy = 1\r\n      }\r\n      var msgSanitized = msg.replaceAll(\"happy\", \"\")\r\n      msgSanitized = msgSanitized.replaceAll(\"sad\",\"\")\r\n      //Return a tuple\r\n      (isHappy, msgSanitized.split(\" \").toSeq)\r\n    }\r\n  }\r\n)\r\n\r\n//We use this syntax to filter out exceptions\r\nval exceptions = goodBadRecords.filter(_.isFailure)\r\nprintln(\"total records with exceptions: \" + exceptions.count())\r\nexceptions.take(10).foreach(x => println(x.failed))\r\nvar labeledTweets = goodBadRecords.filter((_.isSuccess)).map(_.get)\r\nprintln(\"total records with successes: \" + labeledTweets.count())","user":"anonymous","dateUpdated":"2018-09-24T05:22:31+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"messagesRDD: org.apache.spark.rdd.RDD[org.apache.spark.sql.Row] = MapPartitionsRDD[44] at rdd at <console>:67\ngoodBadRecords: org.apache.spark.rdd.RDD[scala.util.Try[(Int, Seq[String])]] = MapPartitionsRDD[45] at map at <console>:71\nexceptions: org.apache.spark.rdd.RDD[scala.util.Try[(Int, Seq[String])]] = MapPartitionsRDD[46] at filter at <console>:73\ntotal records with exceptions: 0\nlabeledTweets: org.apache.spark.rdd.RDD[(Int, Seq[String])] = MapPartitionsRDD[48] at map at <console>:71\ntotal records with successes: 3864\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=7","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=8","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=9","http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=10"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1537765965221_1044830657","id":"20180924-051245_1436583264","dateCreated":"2018-09-24T05:12:45+0000","dateStarted":"2018-09-24T05:22:31+0000","dateFinished":"2018-09-24T05:22:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1777"},{"text":"%spark2\r\nlabeledTweets.take(10).foreach(x => println(x))","user":"anonymous","dateUpdated":"2018-09-24T05:22:49+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"(1,WrappedArray(rt, preaching, if, youre, , with, someone, forget, about, what, everyone, else, says))\n(1,WrappedArray(i, really, hope, ur, , wit, life, cause, u, a, cool, indi, —, cant, complain, , https//tco/kpc9elin4o))\n(1,WrappedArray(rt, thumbelinaiq, “stop, comparing, yourself, to, other, people, just, choose, to, be, , and, live, your, own, life”, ―, roy, t, bennett, the, l…))\n(1,WrappedArray(rt, troytheblackguy, all, she, wanted, to, do, was, say, , birthday, to, her, friend, but, twitter, just, couldnt, let, her, live, lmaooo, https//tco/x…))\n(1,WrappedArray(rt, tyreek__, dreww9st, , birthday, big, bro))\n(1,WrappedArray(mrsginag0910, while, im, , you, used, yahoo, sports, im, not, thrilled, with, your, method, how, about, we, do, a, 6th, and, this, time, useyourbrain))\n(1,WrappedArray(freddiemsmith, could, you, wish, my, best, friend, alonadanger, a, very, , birthday))\n(1,WrappedArray(mirandayikes, i, love, you, birthday, triplet, i, hope, i, can, make, you, , and, we, become, good, friends, soon, stay, safe, and, cute))\n(1,WrappedArray(, bday, rylee, hope, its, been, an, amazing, day, 💜💜💜, https//tco/3mfxy3vylt))\n(1,WrappedArray(rt, stormzy1, do, what, makes, you, , mate))\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=11"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1537765987554_-1063260483","id":"20180924-051307_1014650793","dateCreated":"2018-09-24T05:13:07+0000","dateStarted":"2018-09-24T05:22:49+0000","dateFinished":"2018-09-24T05:22:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1778"},{"text":"%spark2\r\nval hashingTF = new HashingTF(2000)\r\n\r\n//Map the input strings to a tuple of labeled point + input text\r\nval input_labeled = (labeledTweets.map(\r\n  t => (t._1, hashingTF.transform(t._2)))\r\n  .map(x => new LabeledPoint((x._1).toDouble, x._2)))","user":"anonymous","dateUpdated":"2018-09-24T05:23:17+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"hashingTF: org.apache.spark.mllib.feature.HashingTF = org.apache.spark.mllib.feature.HashingTF@568d42c6\ninput_labeled: org.apache.spark.rdd.RDD[org.apache.spark.mllib.regression.LabeledPoint] = MapPartitionsRDD[50] at map at <console>:79\n"}]},"apps":[],"jobName":"paragraph_1537766001541_-2063323650","id":"20180924-051321_1142887703","dateCreated":"2018-09-24T05:13:21+0000","dateStarted":"2018-09-24T05:23:17+0000","dateFinished":"2018-09-24T05:23:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1779"},{"text":"%spark2\r\ninput_labeled.take(10).foreach(println)","user":"anonymous","dateUpdated":"2018-09-24T05:23:26+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"(1.0,(2000,[170,433,526,750,831,893,1034,1372,1378,1472,1552,1650,1777],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[0,19,26,705,737,856,995,1078,1170,1310,1329,1372,1477,1526,1604,1778],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[130,228,307,333,346,388,433,470,493,625,656,674,706,1263,1372,1486,1549,1612,1710,1750,1777,1806,1879],[1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[23,83,122,295,307,388,433,493,563,622,968,1164,1234,1238,1372,1395,1534,1716,1852,1910,1978],[1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0]))\n(1.0,(2000,[295,433,598,632,1372,1705,1726],[1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[157,237,270,333,464,574,654,682,793,820,993,1018,1170,1263,1372,1373,1425,1534,1547,1605,1650,1707,1777],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[213,295,495,763,1170,1238,1372,1425,1727,1916,1920,1944],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[0,168,240,295,333,347,349,433,442,782,993,1041,1249,1329,1372,1425,1525,1642,1833],[1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,3.0,1.0,2.0,1.0,1.0,1.0]))\n(1.0,(2000,[0,296,535,661,1258,1372,1476,1605,1752,1754,1826],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n(1.0,(2000,[433,526,952,1372,1425,1534,1691,1704],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0]))\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=12"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1537766015108_1171033983","id":"20180924-051335_2145616236","dateCreated":"2018-09-24T05:13:35+0000","dateStarted":"2018-09-24T05:23:26+0000","dateFinished":"2018-09-24T05:23:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1780"},{"text":"%spark2\r\n//We're keeping the raw text for inspection later\r\nvar sample = (labeledTweets.take(1000).map(\r\n  t => (t._1, hashingTF.transform(t._2), t._2))\r\n  .map(x => (new LabeledPoint((x._1).toDouble, x._2), x._3)))","user":"anonymous","dateUpdated":"2018-09-24T05:23:39+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sample: Array[(org.apache.spark.mllib.regression.LabeledPoint, Seq[String])] = Array(((1.0,(2000,[405,775,1372,1754,1993],[1.0,1.0,1.0,1.0,1.0])),WrappedArray(poppinmahle, \"\", bday, pretty, girl😍🎈🎉)), ((1.0,(2000,[163,201,343,433,580,584,630,656,899,1138,1310,1320,1330,1371,1372,1400,1425,1433,1541,1543,1643,1746,1760],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0,1.0])),WrappedArray(rt, robinthede, really, some, are, disappointed, that, maddow, only, has, 2005, like, you, would, only, be, \"\", w/, 20, yrs, of, indepth, tax, analysis…)), ((1.0,(2000,[44,163,170,213,237,388,430,656,674,688,781,1036,1076,1329,1368,1371,1372,1425,1526,1564,1604,1760],[1.0,1.0,1.0,1.0,1.0,1.0,1.0,4.0,1.0,1.0,1.0,1.0,1.0,2.0,1.0,1.0,2.0,1.0,1.0,1.0,1.0,1.0])),Wrap..."}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://sandbox-hdp.hortonworks.com:4040/jobs/job?id=13"],"interpreterSettingId":"spark2"}},"apps":[],"jobName":"paragraph_1537766028751_1319977739","id":"20180924-051348_428331769","dateCreated":"2018-09-24T05:13:48+0000","dateStarted":"2018-09-24T05:23:39+0000","dateFinished":"2018-09-24T05:23:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1781"},{"text":"%spark2\n","user":"anonymous","dateUpdated":"2018-09-24T05:14:03+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1537766043926_-113388838","id":"20180924-051403_937427612","dateCreated":"2018-09-24T05:14:03+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1782"}],"name":"Cleaning-Raw-Twitter-Data","id":"2DRTT5Y8H","noteParams":{},"noteForms":{},"angularObjects":{"spark2:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}